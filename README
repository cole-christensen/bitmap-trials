test.c segfaults regularly for some reason which is not interesting enough to debug. test2.c is a rewrite/copy which manages to work... to an extent.
